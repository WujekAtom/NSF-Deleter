<?xml version='1.0' encoding='utf-8'?>
<<<<<<< HEAD
<agent name='(CheckClusterMailbox)' xmlns='http://www.lotus.com/dxl' version='9.0'
 maintenanceversion='1.10' replicaid='C125831D007B6F4A' hide='v3' publicaccess='false'
 designerversion='8.5.3'>
<noteinfo noteid='2a6' unid='3FA19B30E231AEBFC12581A70049BADD' sequence='74'>
<created><datetime dst='true'>20170926T152519,65+02</datetime></created>
<modified><datetime dst='true'>20181006T002826,51+02</datetime></modified>
<revised><datetime dst='true'>20180710T153406,90+02</datetime></revised>
<lastaccessed><datetime dst='true'>20181006T002826,50+02</datetime></lastaccessed>
<addedtofile><datetime dst='true'>20181006T002826,50+02</datetime></addedtofile></noteinfo>
<updatedby><name>CN=Tomasz Wieszczura/OU=Poland/O=IBM</name></updatedby>
<wassignedby><name>CN=Tomasz Wieszczura/OU=Poland/O=IBM</name></wassignedby>
<designchange><datetime dst='true'>20180710T153408,01+02</datetime></designchange>
<trigger type='agentlist'/>
<documentset type='all'/><code event='action'><javaproject class='JavaAgent.class'
 codepath='c:\Notes\Data'><java name='JavaAgent.java'>import lotus.domino.*;

public class JavaAgent extends AgentBase {

    public void NotesMain() {

      try {
          Session session = getSession();
          AgentContext agentContext = session.getAgentContext();

          // (Your code goes here)
          checkReplicasOnCluster();
      }
      catch(NotesException ne)
      {
    	  ne.printStackTrace();
      }
      catch(Exception e) {
          e.printStackTrace();
       }
   }
    
    
    /*
     * Method is checking if databases replicas exist on both servers.
     * TODO: Implement checking value from configuration to check on what servers checking should be done,
     * and from which server delete the databases [both n cluster or just one of them] 
     */
    public void checkReplicasOnCluster() throws NotesException
    {
    	Session session = getSession();
    	AgentContext agt = session.getAgentContext();
    	Database db = agt.getCurrentDatabase();
    	View viewQueue = db.getView("RequestQueue");
    	Document doc;
    	Document docTmp = null;
    	
    	Document profileDoc = db.getProfileDocument("Configuration", "");
    	
    	String mail01srv = profileDoc.getItemValueString("serverReplica1");
    	String mail02srv = profileDoc.getItemValueString("serverReplica2");
    	String fileName = profileDoc.getItemValueString("prefix");
    	
    	// Flag for deleting or not the DB from replicas servers
    	String deleteFromCluster1 = profileDoc.getItemValueString("cluster1delete");
    	String deleteFromCluster2 = profileDoc.getItemValueString("cluster2delete");
    	
//    	String mail01srv = "SVEHAPPL01/SRV/EPCOS";
//    	String mail02srv = "SVEHAPPL02/SRV/EPCOS";
//    	String fileName = "mail/";
    	
    	Database dbMail01;
    	Database dbMail02;
    	//String noExist = "NOEXIST";
    	System.out.println("START");
    	
    	// VERY IMPORTANT! If this is true, then after every iteration the view is refreshed
    	// and the reference to Document is missing. The agent interrupt executing with error
    	// Null Pointer Exception, at the line with GetNextDocument(doc).
    	// setAutoUpdate(false)
    	viewQueue.setAutoUpdate(false);
    	doc = viewQueue.getFirstDocument();
    	
    	while (doc!=null)
    	{    		
    		fileName = fileName.concat(doc.getItemValueString("reqEGID")).concat(".nsf");
    		dbMail01 = session.getDatabase(mail01srv, fileName, false);
    		dbMail02 = session.getDatabase(mail02srv, fileName, false);
    		System.out.println(fileName + " === " + dbMail01);
    		System.out.println(fileName + " === " + dbMail02);
    		

    		if ((dbMail01 == null) &amp;&amp; (dbMail02 == null))
    		{
    			System.out.println("no mailbox");
    			doc.replaceItemValue("reqMail01", "");
    			doc.replaceItemValue("reqMail02", "");
    			doc.replaceItemValue("reqStatus", "NOEXIST");    	
    			
    			//dbMail01.recycle();
    			//dbMail02.recycle();
    		}
    			
    		else   
    		{
	    		if (dbMail01!=null)
	    		{
	    			doc.replaceItemValue("reqMail01", dbMail01.getFilePath());
	    			dbMail01.recycle();
	    		}
	    		else
	    		{
	    			doc.replaceItemValue("reqMail01", "");    			
	    		}
	    		
	    		if (dbMail02!=null)
	    		{
	    			doc.replaceItemValue("reqMail02", dbMail02.getFilePath());
	    			dbMail02.recycle();
	    		}
	    		else
	    		{
	    			doc.replaceItemValue("reqMail02", "");    			
	    		}
    		}
	
    	
    		//System.out.println("przed zapisem");
    		doc.computeWithForm(false, false);
    		if (!doc.save())
        		System.out.println("CAN'T SAVE: " + doc.getItemValueString("reqEGID"));
    		
    		//System.out.println("PO zapisie: " + doc.getItemValueString("reqProcess"));
    		
    		fileName = "mail/";
    		docTmp = viewQueue.getNextDocument(doc);
    		doc.recycle();
    		doc = docTmp;
    	}
    	
    	System.out.println("END");
    }

    
    /*
     * Old, test method. DO NOT USE.
     */
	public void checkReplicasOnCluster2() throws NotesException
	{
		Session session = getSession();
		AgentContext agt = session.getAgentContext();
		Database db = agt.getCurrentDatabase();
		View viewQueue = db.getView("RequestQueue");
		Document doc = null;
		Document docTmp = null;
		String mail01srv = "SVEHMAIL01/SRV/EPCOS";
		String mail02srv = "SVEHMAIL02/SRV/EPCOS";
		String fileName = "mail/";
		
		Database dbMail01;
		Database dbMail02;
		
		System.out.println("START");
		
		doc = viewQueue.getFirstDocument();
		
		while (doc!=null)
		{    		
			fileName = fileName.concat(doc.getItemValueString("reqEGID")).concat(".nsf");
			dbMail01 = session.getDatabase(mail01srv, fileName, false);
			
			System.out.println(fileName + " === " + dbMail01);					
			
			fileName = "mail";
			docTmp = viewQueue.getNextDocument(doc);
			doc.recycle();
			doc = docTmp;
		}
		
		System.out.println("END");
	}
}</java></javaproject></code>
<rundata processeddocs='0' exitcode='0'>
<agentmodified><datetime dst='true'>20180710T153408,04+02</datetime></agentmodified></rundata>
<item name='$JavaCompilerSource'><text>1.3</text></item>
<item name='$JavaCompilerTarget'><text>1.2</text></item></agent>
=======
<note class='filter' xmlns='http://www.lotus.com/dxl' version='9.0' maintenanceversion='1.10'
 replicaid='C12582CD003E2D74'>
<noteinfo noteid='2a6' unid='3FA19B30E231AEBFC12581A70049BADD' sequence='75'>
<created><datetime dst='true'>20170926T152519,65+02</datetime></created>
<modified><datetime dst='true'>20180717T132816,69+02</datetime></modified>
<revised><datetime dst='true'>20180717T132816,68+02</datetime></revised>
<lastaccessed><datetime dst='true'>20180717T132816,68+02</datetime></lastaccessed>
<addedtofile><datetime dst='true'>20180717T131924,96+02</datetime></addedtofile></noteinfo>
<updatedby><name>CN=Tomasz Wieszczura/OU=Poland/O=IBM</name></updatedby>
<wassignedby><name>CN=Tomasz Wieszczura/OU=Poland/O=IBM</name></wassignedby>
<item name='$FILE' summary='true' sign='true' seal='true'><object><file hosttype='msdos'
 compression='none' flags='sign' encoding='none' name='%%source%%.jar' size='1550'>
<created><datetime dst='true'>20170926T172522,15+02</datetime></created>
<modified><datetime dst='true'>20180717T132816,64+02</datetime></modified><filedata
>
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
ADwAAAC8BQAAAAA=
</filedata></file></object></item>
<item name='$FILE' summary='true' sign='true' seal='true'><object><file hosttype='msdos'
 compression='none' flags='sign' encoding='none' name='%%object%%.jar' size='1578'>
<created><datetime dst='true'>20170926T172522,17+02</datetime></created>
<modified><datetime dst='true'>20180717T132816,64+02</datetime></modified><filedata
>
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
</filedata></file></object></item>
<item name='$JavaCompilerSource'><text>1.3</text></item>
<item name='$JavaCompilerTarget'><text>1.2</text></item>
<item name='$AssistVersion'><datetime dst='true'>20180717T132816,67+02</datetime></item>
<item name='$TITLE' sign='true'><text>(CheckClusterMailbox)</text></item>
<item name='$AssistType' sign='true'><number>65427</number></item>
<item name='$AssistLastRun' sign='true'>
<rawitemdata type='400'>
AAAAAAAAAAA=
</rawitemdata></item>
<item name='$AssistDocCount' sign='true'><number>0</number></item>
<item name='$FlagsExt' sign='true'><text/></item>
<item name='$AssistFlags' sign='true'><text>EHs</text></item>
<item name='$AssistTrigger'><text>4</text></item>
<item name='$AssistInfo' sign='true'>
<rawitemdata type='11'>
AQAEAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
</rawitemdata></item>
<item name='$AssistQuery' sign='true'>
<rawitemdata type='f'>
gQYAAAAA
</rawitemdata></item>
<item name='$AssistAction' sign='true'>
<rawitemdata type='10'>
gQKT/04ADwANAB8AAQAAAAAAAABKYXZhQWdlbnQuY2xhc3NjOlxOb3Rlc1xEYXRhJSVzb3VyY2Ul
JS5qYXIAJSVvYmplY3QlJS5qYXIAAAA=
</rawitemdata></item>
<item name='$AssistAction_Ex' sign='true'>
<rawitemdata type='14'>
gQI=
</rawitemdata></item>
<item name='$Restricted' sign='true'><number>1</number></item>
<item name='$Flags'><text>fJj3</text></item>
<item name='$DesignerVersion'><text>8.5.3</text></item>
<item name='$AssistRunInfo' summary='true'>
<rawitemdata type='3'>
BgABAAAACACiBAAAAAAAAAUAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAgwM/AM2CJcF0LT4AzYIlwQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAA
</rawitemdata></item></note>
>>>>>>> 6484f1daf58b719c0503e1f0661e915e98e1b8ec

